<!-- Universidad del Valle de Guatemala -->
<!-- Alberto Andres Urizar Mancia   #17632 -->
<!-- Gustavo Adolfo de LeÃ³n Tobias  #17085 -->
<!-- Miniproyecto 5 -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miniproyecto 5</title>
</head>
<body>
    <!-- D = 2012, y = 1000/403 x - 3992.55 -->
    <canvas id="board" width="1800" height="900"></canvas>
    <!-- Logica de fuzzy -->
    <script>
        board = document.getElementById('board');
        ctx = board.getContext('2d',{alpha: false});
        // Posiciones iniciales
        let jugX = Math.floor(Math.random()*board.width);
        let jugY = Math.floor(Math.random()*board.height);

        let pelotaX = Math.floor(Math.random()*board.width);
        let pelotaY = Math.floor(Math.random()*board.height);

        let tamanio = 20;
        let D = Math.sqrt(Math.pow(board.width,2) + Math.pow(board.height,2));

        let jugador = {
            x: jugX,
            y: jugY
        }

        let pelota = {
            x: pelotaX,
            y: pelotaY
        }

        let porteria = {
            x: board.width,
            y: board.height/2
        }

        function entradaLejos(x){
            let y
            if(x<=1207.2){
                y = 0
            }else{
                y = (625/503)*x - 1500; 
                
            }
            
            return y/1000;
        }

        function entradaMediano(x){
            let y
            if(x<602.774 || x>1409.226){
                y = 0
            }else{
                y = -2.48 * Math.abs(x-1006)+1000
            }
            
            return y/1000;
        }
        function entradaCerca(x){
            let y
            if(x<=804.8){
                y = -(1000/804.8)*x + 1000
                
            }else{
                y = 0
            }
            
            return y/1000;
        }
        function bienColocado(x){
            let y
            if(x<=9 || x>351){
                y = 100
            }else if(x>9 && x<=10){
                y = (-100*x)+1000
            }else if(x>=350 && x<=351){
                y = 100*x-35000
            }
            else{
                y = 0
            }
            
            return y
        }
        function malColocado(x){
            let y

            if(x <10 || x > 350){
                y = 0
            }else if(x >10 && x <=11){
                y = (100*x)-1000
            }else if(x >11 && x <=349){
                y = 100
            }else if(x>349 && x <= 350){
                y = (-100*x)+35000
            }else{
                y = 0
            }
            return y
        }
        function respMucho(x){
            let y
            if(x<234){
                y = 0
            }else{
                y = (9.97 * x)-2339.95
            }
            return y
        }
        function respNormal(x){
            let y
            if(x<100 || x>=234){
                y = 0
            }else if(x > 100 && x < 234){
                y = - (7503/503)*(Math.abs(x-(503/3))) + 1000
            }
            else{
                 y = 0 
            }
            return y
        }
        function respPoco(x){
            let y 
            if (x >100){
                y = 0
            }else{
                y = -(1000/100.627)*x +1000
            }
        }

        function respGrande(x){
            let y

            if(x <10 || x > 350){
                y = 0
            }else if(x >10 && x <=11){
                y = (100*x)-1000
            }else if(x >11 && x <=349){
                y = 100
            }else if(x>349 && x <= 350){
                y = (-100*x)+35000
            }else{
                y = 0
            }
            return y
        }
        function respBajo(x){
            let y
            if(x<=9 || x>351){
                y = 100
            }else if(x>9 && x<=10){
                y = (-100*x)+1000
            }else if(x>=350 && x<=351){
                y = 100*x-35000
            }
            else{
                y = 0
            }
            
            return y
        }

        function respMuchoInversa(y){
            let x
            x = (y+2339.95)/9.97
            return x
        }
        function respNormalInversa(y){
            let x1,x2
            x1 = -(503/7503)*(y-1000) + (503/3)
            x2 = (503/7503)*(y-1000) + (503/3)
            return [x1,x2]
        }
        function RespPocoInversa(y){
            let x
            x = -(y-1000)*(100.627/1000);
            return x
        }
        function RespGrandeInversa(y){
            let x1,x2
            x1 = (y+1000)/100
            x2 = -(y-35000)/100
            return [x1,x2]
        }
        function RespBajoInversa(y){
            let x1,x2
            x1 = (y-1000)/(-100)
            x2 = (y+35000)/100
            return [x1, x2]
        }
        function defuzzyDist(xs,u){
            let respuesta = 0 
            respuesta = u*(xs.reduce((a, b) => a + b, 0))/(4*u)
            return respuesta
        }

        function dibujarPorteria(){
            ctx.beginPath();
            ctx.lineWidth = "5";
            ctx.strokeStyle = "gray";
            ctx.rect(porteria.x-20,porteria.y-30,20,60);
            ctx.stroke();
        }

        function dibujarPelota(x,y){
            ctx.beginPath();
            ctx.fillStyle = "#E44124";
            ctx.arc(x,y,10,0,Math.PI*2);
            ctx.fill();
            ctx.closePath();
        }

        function dibujarJugador(x,y,angulo){
            let radianes = angulo*Math.PI/180;
            ctx.translate(x,y);
            ctx.rotate(radianes)
            ctx.beginPath();
            ctx.fillStyle = "#3285E3";
            ctx.moveTo(tamanio*Math.cos(0),tamanio*Math.sin(0));
            for (var i = 1; i <= 3;i += 1) {
                ctx.lineTo (tamanio * Math.cos(i * 2 * Math.PI / 3), tamanio * Math.sin(i * 2 * Math.PI / 3));
            }
            // ctx.lineTo (tamanio * Math.cos(2 * Math.PI / 3), tamanio * Math.sin(2 * Math.PI / 3));
            // ctx.lineTo ((tamanio-10) * Math.cos(2 * 2 * Math.PI / 3), (tamanio+20) * Math.sin(2 * 2 * Math.PI / 3));
            // ctx.lineTo ((tamanio+10) * Math.cos(3 * 2 * Math.PI / 3), (tamanio+20) * Math.sin(3 * 2 * Math.PI / 3));
            ctx.closePath();
            ctx.fill();
            ctx.rotate(-radianes);
            ctx.translate(-x,-y);
            // ctx.moveTo(x,y);
            // ctx.lineTo(x-10,y+30);
            // ctx.lineTo(x+10,y+30);
            // ctx.fill();
            // ctx.closePath();
        }

        // Dibujar pelota
        dibujarPelota(pelota.x, pelota.y);
        // Dibujar jugador
        dibujarJugador(jugador.x, jugador.y, 80);
        //Dibujar porteria
        dibujarPorteria();
        


        // Inicio de Fuzzy
        let entro = true;
        // console.log("Jugador"+JSON.stringify(jugador));
        // console.log("Pelota"+JSON.stringify(pelota));
        // console.log(Math.sqrt(Math.pow((jugador.x - pelota.x),2)+Math.pow((jugador.y - pelota.y),2)));
        // while(entro){
            // Primer paso medir las variables de entrega crisp
            let distancia = Math.sqrt(Math.pow((jugador.x - pelota.x),2)+Math.pow((jugador.y - pelota.y),2));
            console.log("Distancia: "+distancia);
            let angulo =  (Math.atan2((jugador.y-pelota.y),(jugador.x-pelota.x)))*(180/Math.PI);
            if(angulo < 0){
                angulo = angulo + 360;
            }
            console.log("Angulo: "+angulo);
            // Si esta lejos me muevo mucho
            //Si esta mediano me muevo normal
            //Si esta cerca me muevo poco
            let entradaL = entradaLejos(distancia);
            let entradaM = entradaMediano(distancia);
            let entradaC = entradaCerca(distancia);
            //let anguloBien = bienColocado(angulo);
            //let anguloMal = malColocado(angulo);
            console.log("**************************************************")
            console.log("Entrada Lejos "+entradaL*1000);
            console.log("Entrada Mediana "+entradaM*1000);
            console.log("Entrada Cerca "+entradaC*1000);
            //console.log("Angulo bien colocado "+anguloBien);
            //console.log("Angulo mal colocado "+anguloMal);

            //let maximo = Math.max(entradaL*1000,entradaM*1000,entradaC*1000)

            let respSalidaL = respMuchoInversa(entradaL*1000)
            let respSalidaN = respNormalInversa(entradaM*1000)
            let respSalidaP = RespPocoInversa(entradaC*1000)
            
            //let respSalidaG = respMuchoInversa(anguloBien)
            //let respSalidaB = respMuchoInversa(anguloMal)
            console.log("**************************************************")
            console.log("Salida Largo "+respSalidaL);
            console.log("Salida Normal1 "+respSalidaN[0]);
            console.log("Salida Normal2 "+respSalidaN[1]);
            console.log("Salida Poco "+respSalidaP);
            //xs = [respSalidaL,respSalidaN[0],respSalidaN[1],+respSalidaP]
            //resp = defuzzyDist(xs,maximo)
            //console.log("Se debe de mover "+resp+" pixeles")
            //console.log("Salida Grande "+respSalidaG);
            //console.log("Salida Bajo "+respSalidaB);
            
        // }
    </script>
</body>
</html>